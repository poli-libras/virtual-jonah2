function init(){var a=$("#container");scene=new THREE.Scene,renderer=new THREE.WebGLRenderer,scene.add(camera);var b=new THREE.DirectionalLight(16777215);b.position.set(1,1,1).normalize(),scene.add(b),renderer.setSize(WIDTH,HEIGHT),renderer.setClearColor("white",1),a.append(renderer.domElement),camera.position.set(0,1,1),scene.position.set(0,.5,0),camera.lookAt(scene.position);var c=new THREE.JSONLoader;c.load("../resources/model/human.js",function(a){var b=new vj2.Model(a,new THREE.MeshLambertMaterial);b.material.skinning=!0,create_animation(b)})}function create_animation(a){scene.add(a),action_upper_limbs=new vj2.Action_upper_limbs(a,scene),last_frame_time=Date.now(),loop()}function loop(){requestAnimationFrame(loop);var a=Date.now()-last_frame_time;action_upper_limbs.update(a/1e3),renderer.render(scene,camera),last_frame_time=Date.now()}this.vj2=this.vj2||{},function(){"use strict";function a(a,b){this.human_model=a,this.scene=b,this.signs={},this.sign=null;var c,d,e;(new vj2.Limb_config_loader).load("../resources/locations.json",function(a){c=a}),(new vj2.Limb_config_loader).load("../resources/orientations.json",function(a){d=a}),(new vj2.Limb_config_loader).load("../resources/shapes.json",function(a){e=a});var f=this;(new vj2.Sign_config_loader).load("../resources/signs.json",function(a){console.log(a);for(var b in a){var g=a[b],h=g.left_hand_resting?"right":"both",i=c.get_config(g.start_location,h),j=d.get_config(g.start_orientation,h),k=e.get_config(g.shape,h);f.signs[b]=new vj2.Sign(f,f.human_model,i,j,k)}})}var b=a.prototype;b.trace_quaternions=function(){this.trace_quaternions_side("LEFT"),this.trace_quaternions_side("RIGHT")},b.trace_quaternions_side=function(a){console.log(a+" ARM"),this.trace_quaternion("UpArm_"+a.charAt(0)),this.trace_quaternion("LoArm_"+a.charAt(0)),this.trace_quaternion("Hand_"+a.charAt(0)),console.log("==================================================");for(var b=1;5>=b;b++){switch(b){case 1:console.log(a+" THUMB");break;case 2:console.log(a+" INDEX");break;case 3:console.log(a+" MIDDLE");break;case 4:console.log(a+" RING");break;case 5:console.log(a+" PINKY")}for(var c=1;3>=c;c++)this.trace_quaternion("Finger-"+b+"-"+c+"_"+a.charAt(0));console.log("==================================================")}},b.trace_quaternion=function(a){var b=this.human_model.get_bone(a).getWorldQuaternion();console.log(a+" - GLOBAL: ("+b.x+", "+b.y+", "+b.z+", "+b.w+")");var c=this.human_model.get_bone(a).quaternion;console.log(a+" - LOCAL: ("+c.x+", "+c.y+", "+c.z+", "+c.w+")")},b.show_edit_controls=function(a){this.eulerMode&&($(".debug-controls").hide(),$("#"+$("#select-edit-side").val()+"-"+$("#select-edit-part").val()).show())},b.reset_model_pose=function(){for(var a in this.animated_bone_pool){var b=this.animated_bone_pool[a];b.set(0,0,0,1)}},b.toggle_debug=function(){this.reset_model_pose(),this.eulerMode=!this.eulerMode,this.eulerMode?($("#select-edit-part").show(),$("#select-edit-side").show(),this.show_edit_controls()):($(".debug-controls").hide(),$("#select-edit-part").hide(),$("#select-edit-side").hide())},b.animated_bone_pool={},b.get_animated_bone=function(a){return void 0===this.animated_bone_pool[a]&&(this.animated_bone_pool[a]=new vj2.Animated_bone(this.human_model,a)),this.animated_bone_pool[a]},b.update=function(a){void 0!==this.sign&&null!==this.sign&&this.sign.update(a)},b.set_bone_euler=function(a,b,c,d){var e=this.get_animated_bone(a);e.euler_increment(b,c,d)},b.set_sign=function(a){this.sign=this.signs[a],this.sign.start_animation()},vj2.Action_upper_limbs=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a,b){this.bone_name=b,this.model=a,this.quaternion=this.model.get_bone(b).quaternion,this.quaternion_next=this.quaternion.clone(),this.quaternion_prev=this.quaternion.clone(),this.duration=0,this.remaining_time=0,this.done=!0,this.euler_helper=new THREE.Euler(0,0,0),this.quaternion_helper=new THREE.Quaternion(0,0,0)}var b=a.prototype;b.euler_increment=function(a,b,c,d){this.euler_helper.set(a,b,c),this.quaternion_helper.setFromEuler(this.euler_helper),this.increment(this.quaternion_helper.x,this.quaternion_helper.y,this.quaternion_helper.z,this.quaternion_helper.w,d)},b.euler_animate_to=function(a,b,c,d){this.euler_helper.set(a,b,c),this.quaternion_helper.setFromEuler(this.euler_helper),this.animate_to(this.quaternion_helper.x,this.quaternion_helper.y,this.quaternion_helper.z,this.quaternion_helper.w,d)},b.euler_set=function(a,b,c){this.euler_helper.set(a,b,c),this.quaternion_helper.setFromEuler(this.euler_helper),this.set(this.quaternion_helper.x,this.quaternion_helper.y,this.quaternion_helper.z,this.quaternion_helper.w)},b.increment=function(a,b,c,d,e){this.quaternion_next.multiply(new THREE.Quaternion(a,b,c,d)),this.animate_to(this.quaternion_next.x,this.quaternion_next.y,this.quaternion_next.z,this.quaternion_next.w,e)},b.animate_to=function(a,b,c,d,e){void 0===e||0===e?this.set(a,b,c,d):(this.quaternion_prev.copy(this.quaternion),this.quaternion_next.set(a,b,c,d),this.duration=e,this.remaining_time=this.duration,this.done=!1)},b.set=function(a,b,c,d){this.quaternion.set(a,b,c,d),this.quaternion_next.set(a,b,c,d),this.quaternion_prev.set(a,b,c,d),this.end_animation()},b.update=function(a){this.interpolate(this.remaining_time/this.duration),this.remaining_time-=Math.min(a,this.remaining_time)},b.interpolate=function(a){this.done||(THREE.Quaternion.slerp(this.quaternion_next,this.quaternion_prev,this.quaternion,a),0===a&&this.end_animation())},b.end_animation=function(){this.quaternion_prev.copy(this.quaternion_next),this.done=!0,this.remaining_time=0},b.reset_animation=function(){this.remaining_time=this.duration},vj2.Animated_bone=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}var b=a.prototype;b.load=function(a,b){this.loadAjaxJSON(this,a,b)},b.loadAjaxJSON=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState===d.DONE)if(200===d.status||0===d.status)if(d.responseText){var e=JSON.parse(d.responseText),f=a.parse(e);c(f)}else console.error('load_limb_config: "'+b+'" seems to be unreachable or the file is empty.');else console.error("load_limb_config: Couldn't load \""+b+'" ('+d.status+")")},d.open("GET",b,!0),d.withCredentials=!1,d.send(null)},b.parse=function(a){return a},vj2.Config_loader=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}var b=a.prototype;b.get_config=function(a,b){var c={},d="";if("right"==b)for(d in this.right[a])c[d]=this.right[a][d];else if("left"==b)for(d in this.left[a])c[d]=this.left[a][d];else{for(d in this.right[a])c[d]=this.right[a][d];for(d in this.left[a])c[d]=this.left[a][d]}return c},vj2.Limb_config=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}var b=a.prototype=Object.create(vj2.Config_loader.prototype);a.prototype.constructor=a,b.parse=function(a){var b=new vj2.Limb_config;b.right=a,b.left={};for(var c in b.right){var d=b.right[c],e={};for(var f in d){var g=f.split("_")[0],h={};h.x=d[f].x,h.y=-d[f].y,h.z=-d[f].z,h.w=d[f].w,e[g+"_L"]=h}b.left[c]=e}return b},vj2.Limb_config_loader=a}(),window.onload=init;var WIDTH=1e3,HEIGHT=500,VIEW_ANGLE=45,ASPECT=WIDTH/HEIGHT,NEAR=.1,FAR=1e4,camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR),clock=new THREE.Clock,scene,renderer,action_upper_limbs,last_frame_time=0;this.vj2=this.vj2||{},function(){"use strict";function a(a,b,c){THREE.SkinnedMesh.call(this,a,b,c)}var b=a.prototype=Object.create(THREE.SkinnedMesh.prototype);a.prototype.constructor=a,b.get_bone=function(a){for(var b=this.skeleton.bones,c=0;c<b.length;c++)if(b[c].name==a)return b[c]},vj2.Model=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a,b,c,d,e){this.parent=a,this.model=b,this.start_location=c,this.start_orientation=d,this.shape=e,this.bones_moving=[],this.transitions=[]}var b=a.prototype;b.update=function(a){this.bones_moving.forEach(function(b){b.update(a)})},b.start_animation=function(){this.bones_moving=[],this.apply_orientation_quartenions(),this.apply_location_quartenions(),this.apply_shape_quartenions()},b.apply_orientation_quartenions=function(){var a,b={},c={};for(a in this.start_location){var d=this.model.get_bone(a),e=this.start_location[a];b[a]=d.quaternion.clone(),d.quaternion.copy(e)}this.parent.scene.updateMatrixWorld(!0),this.model.skeleton.update();for(a in this.start_orientation){var f=(new THREE.Quaternion).copy(this.start_orientation[a]),g=this.model.get_bone(a).parent.getWorldQuaternion().clone(),h=(new THREE.Quaternion).multiplyQuaternions(g.inverse(),f);void 0!==this.start_location[a]&&(h=(new THREE.Quaternion).multiplyQuaternions(h,(new THREE.Quaternion).copy(this.start_location[a]))),c[a]=h}for(a in b)this.model.get_bone(a).quaternion.copy(b[a]);this.parent.scene.updateMatrixWorld(!0),this.model.skeleton.update();for(a in c){var i=this.parent.get_animated_bone(a);i.done&&(this.bones_moving.push(i),i.animate_to(c[a].x,c[a].y,c[a].z,c[a].w,1.5))}},b.apply_location_quartenions=function(){for(var a in this.start_location){var b=this.parent.get_animated_bone(a);b.done&&(this.bones_moving.push(b),b.animate_to(this.start_location[a].x,this.start_location[a].y,this.start_location[a].z,this.start_location[a].w,1.5))}},b.apply_shape_quartenions=function(){for(var a in this.shape){var b=this.parent.get_animated_bone(a);b.done&&(this.bones_moving.push(b),b.animate_to(this.shape[a].x,this.shape[a].y,this.shape[a].z,this.shape[a].w,1.5))}},vj2.Sign=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}a.prototype=Object.create(vj2.Config_loader.prototype);a.prototype.constructor=a,vj2.Sign_config_loader=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}vj2.Transition=a}();