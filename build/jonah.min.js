function load_model_json(a,b){function c(a){var c=new THREE.SkinnedMesh(a,new THREE.MeshLambertMaterial);c.material.skinning=!0,b(c)}var d=new THREE.JSONLoader;d.load(a,c)}function load_json(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===c.DONE)if(200===c.status||0===c.status)if(c.responseText){var d=JSON.parse(c.responseText);b(d)}else console.error('load_pose_json: "'+a+'" seems to be unreachable or the file is empty.');else console.error("load_pose_json: Couldn't load \""+a+'" ('+c.status+")")},c.open("GET",a,!0),c.withCredentials=!1,c.send(null)}function init(){var a=$("#container");scene=new THREE.Scene,renderer=new THREE.WebGLRenderer,scene.add(camera);var b=new THREE.DirectionalLight(16777215);b.position.set(1,1,1).normalize(),scene.add(b),renderer.setSize(WIDTH,HEIGHT),renderer.setClearColor("white",1),a.append(renderer.domElement),camera.position.set(0,1,1),scene.position.set(0,.5,0),camera.lookAt(scene.position),load_model_json("../resources/model/human.js",create_animation)}function create_animation(a){scene.add(a),action_upper_limbs=new vj2.Action_upper_limbs(a,scene),last_frame_time=Date.now(),loop()}function rotate_camera(){var a=5e-4*Date.now();camera.position.y=1,camera.position.z=.5*Math.cos(a),camera.position.x=.5*Math.sin(a),camera.lookAt(scene.position)}function loop(){requestAnimationFrame(loop);var a=Date.now()-last_frame_time;action_upper_limbs.update(a/1e3),renderer.render(scene,camera),last_frame_time=Date.now()}this.vj2=this.vj2||{},function(){"use strict";function a(a,b){this.human_model=a,this.scene=b,this.upper_limbs_left=this.create_upper_limb("LEFT"),this.upper_limbs_right=this.create_upper_limb("RIGHT"),this.bones_moving=new vj2.List,this.eulerMode=!1,this.locations=new vj2.Locations,this.orientations=new vj2.Orientations,this.shapes=new vj2.Shapes}var b=a.prototype;b.create_upper_limb=function(a){return new vj2.Upper_limbs(this.create_hand(a),this.create_arm_bones(a),a)},b.create_arm_bones=function(a){var b=this.get_model_bone("UpArm_"+a.charAt(0)).quaternion,c=this.get_model_bone("LoArm_"+a.charAt(0)).quaternion,d=this.get_model_bone("Hand_"+a.charAt(0)).quaternion;return new vj2.Arm_bones(b,c,d,a)},b.create_hand=function(a){for(var b=[],c=1;5>=c;c++)b.push(this.create_finger(c,a));return new vj2.Hand(b[0],b[1],b[2],b[3],b[4],a)},b.create_finger=function(a,b){for(var c=[],d=1;3>=d;d++)c.push(this.get_model_bone("Finger-"+a+"-"+d+"_"+b.charAt(0)).quaternion);return new vj2.Finger(c[0],c[1],c[2],b)},b.trace_quaternions=function(){this.trace_quaternions_side("LEFT"),this.trace_quaternions_side("RIGHT")},b.trace_quaternions_side=function(a){console.log(a+" ARM"),this.trace_quaternion("UpArm_"+a.charAt(0)),this.trace_quaternion("LoArm_"+a.charAt(0)),this.trace_quaternion("Hand_"+a.charAt(0)),console.log("==================================================");for(var b=1;5>=b;b++){switch(b){case 1:console.log(a+" THUMB");break;case 2:console.log(a+" INDEX");break;case 3:console.log(a+" MIDDLE");break;case 4:console.log(a+" RING");break;case 5:console.log(a+" PINKY")}for(var c=1;3>=c;c++)this.trace_quaternion("Finger-"+b+"-"+c+"_"+a.charAt(0));console.log("==================================================")}},b.trace_quaternion=function(a){var b=this.get_model_bone(a).getWorldQuaternion();console.log(a+" - GLOBAL: ("+b.x+", "+b.y+", "+b.z+", "+b.w+")");var c=this.get_model_bone(a).quaternion;console.log(a+" - LOCAL: ("+c.x+", "+c.y+", "+c.z+", "+c.w+")")},b.show_edit_controls=function(){this.eulerMode&&($(".debug-controls").hide(),$("#"+$("#select-edit-side").val()+"-"+$("#select-edit-part").val()).show())},b.reset_model_pose=function(){for(var a in this.animated_bone_pool){var b=this.animated_bone_pool[a];b.set_quaternion(0,0,0,1)}},b.toggle_debug=function(){this.reset_model_pose(),this.eulerMode=!this.eulerMode,this.eulerMode?($("#select-edit-part").show(),$("#select-edit-side").show(),this.show_edit_controls()):($(".debug-controls").hide(),$("#select-edit-part").hide(),$("#select-edit-side").hide())},b.animated_bone_pool={},b.get_animated_bone=function(a){return void 0===this.animated_bone_pool[a]&&(this.animated_bone_pool[a]=new vj2.Animated_bone(this.get_model_bone(a).quaternion)),this.animated_bone_pool[a]},b.update=function(a){this.eulerMode&&this.eulerUpdate(a),this.quaternionUpdate(a)},b.eulerUpdate=function(a){this.upper_limbs_right.update(a),this.upper_limbs_left.update(a)},b.quaternionUpdate=function(a){for(var b=this.bones_moving.head;null!==b;)b.obj.update(a),b.obj.done&&this.bones_moving.remove(b.obj),b=b.next},b.get_model_bone=function(a){for(var b=this.human_model.skeleton.bones,c=0;c<b.length;c++)if(b[c].name==a)return b[c]},b.set_hand=function(a,b,c,d){a="undefined"==typeof a?"both":a;var e,f,g,h,i=this.locations.get_config(b,a),j=this.orientations.get_config(c,a),k=this.shapes.get_config(d,a),l={},m={};for(h in i)e=this.get_model_bone(h),f=i[h],l[h]=e.quaternion.clone(),e.quaternion.set(f.x,f.y,f.z,f.w);this.scene.updateMatrixWorld(!0),this.human_model.skeleton.update();for(h in j){var n=h,o=j[h];if(e=this.get_model_bone(n),f=(new THREE.Quaternion).multiplyQuaternions(e.parent.getWorldQuaternion().clone().inverse(),(new THREE.Quaternion).set(o.x,o.y,o.z,o.w)),void 0!==i[n]){var p=i[n];f=(new THREE.Quaternion).multiplyQuaternions(f,(new THREE.Quaternion).set(p.x,p.y,p.z,p.w))}m[n]=f}for(h in l)e=this.get_model_bone(h),f=l[h],e.quaternion.set(f.x,f.y,f.z,f.w);this.scene.updateMatrixWorld(!0),this.human_model.skeleton.update();for(h in m)g=this.get_animated_bone(h),f=m[h],g.done&&(this.bones_moving.add(g),g.animate_to(f.x,f.y,f.z,f.w,1.5));for(h in i)g=this.get_animated_bone(h),g.done&&(this.bones_moving.add(g),f=i[h],g.animate_to(f.x,f.y,f.z,f.w,1.5));for(h in k)g=this.get_animated_bone(h),g.done&&(this.bones_moving.add(g),f=k[h],g.animate_to(f.x,f.y,f.z,f.w,1.5))},vj2.Action_upper_limbs=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a){this.quaternion=a,this.quaternion_next=a.clone(),this.quaternion_prev=a.clone(),this.duration=0,this.remaining_time=0,this.done=!0,this.eulerHelper=new THREE.Euler(0,0,0),this.quaternionHelper=new THREE.Quaternion(0,0,0)}var b=a.prototype;b.euler_animate_to=function(a,b,c,d){this.eulerHelper.set(a,b,c),this.quaternionHelper.setFromEuler(this.eulerHelper),this.quaternion_next.multiply(this.quaternionHelper),this.duration=d,this.remaining_time=this.duration,this.done=!1},b.animate_to=function(a,b,c,d,e){this.quaternion_prev.copy(this.quaternion),this.quaternion_next.set(a,b,c,d),this.duration=e,this.remaining_time=this.duration,this.done=!1},b.set_quaternion=function(a,b,c,d){this.quaternion.set(a,b,c,d),this.quaternion_next.set(a,b,c,d),this.quaternion_prev.set(a,b,c,d),this.end_animation()},b.update=function(a){this.interpolate(this.remaining_time/this.duration),this.remaining_time-=Math.min(a,this.remaining_time)},b.interpolate=function(a){this.done||(THREE.Quaternion.slerp(this.quaternion_next,this.quaternion_prev,this.quaternion,a),0===a&&this.end_animation())},b.end_animation=function(){this.quaternion_prev.copy(this.quaternion_next),this.done=!0,this.remaining_time=0},b.reset_animation=function(){this.remaining_time=this.duration},vj2.Animated_bone=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a,b,c,d){this.up_arm=new vj2.Animated_bone(a),this.lo_arm=new vj2.Animated_bone(b),this.wrist=new vj2.Animated_bone(c),this.direction=d}var b=a.prototype;b.update=function(a){this.up_arm.update(a),this.lo_arm.update(a),this.wrist.update(a)},b.update_wrist=function(a,b,c){this.wrist.euler_animate_to(a,b,c,.1)},b.update_uparm=function(a,b,c){this.up_arm.euler_animate_to(a,b,c,.1)},b.update_loarm=function(a,b,c){this.lo_arm.euler_animate_to(a,b,c,.1)},vj2.Arm_bones=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a,b,c,d){this.phalange1=new vj2.Animated_bone(a),this.phalange2=new vj2.Animated_bone(b),this.phalange3=new vj2.Animated_bone(c),this.phalange_list=[this.phalange1,this.phalange2,this.phalange3],this.direction=d}var b=a.prototype;b.update_phalange=function(a,b,c,d){switch(a){case 1:this.phalange1.euler_animate_to(b,c,d,.1);break;case 2:this.phalange2.euler_animate_to(b,c,d,.1);break;case 3:this.phalange3.euler_animate_to(b,c,d,.1)}},b.update=function(a){this.phalange_list.forEach(function(b){b.update(a)})},vj2.Finger=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a,b,c,d,e,f){this.thumb=a,this.index=b,this.middle=c,this.ring=d,this.pinky=e,this.direction=f,this.list_fingers=[this.thumb,this.index,this.middle,this.ring,this.pinky]}var b=a.prototype;b.update_finger=function(a,b,c,d,e){switch(a){case"THUMB":this.thumb.update_phalange(b,c,d,e);break;case"INDEX":this.index.update_phalange(b,c,d,e);break;case"MIDDLE":this.middle.update_phalange(b,c,d,e);break;case"RING":this.ring.update_phalange(b,c,d,e);break;case"PINKY":this.pinky.update_phalange(b,c,d,e)}},b.update=function(a){this.list_fingers.forEach(function(b){b.update(a)})},vj2.Hand=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}var b=a.prototype;b.load=function(a){load_json(a,function(a){return function(b){a.right=b,a.left={};for(var c in a.right){var d=a.right[c],e={};for(var f in d){var g=f.split("_")[0],h={};h.x=d[f].x,h.y=-d[f].y,h.z=-d[f].z,h.w=d[f].w,e[g+"_L"]=h}a.left[c]=e}}}(this))},b.get_config=function(a,b){var c={},d="";if("right"==b)for(d in this.right[a])c[d]=this.right[a][d];else if("left"==b)for(d in this.left[a])c[d]=this.left[a][d];else{for(d in this.right[a])c[d]=this.right[a][d];for(d in this.left[a])c[d]=this.left[a][d]}return c},vj2.Limb_config=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){this.head=null,this.tail=null}var b=a.prototype;b.add=function(a){null===this.head?(this.head={obj:a,next:null},this.tail=this.head):(this.tail.next={obj:a,next:null},this.tail=this.tail.next)},b.remove=function(a){if(this.head.obj===a)this.head=this.head.next;else for(var b=this.head;null!==b.next;){if(b.next.obj===a){b.next=b.next.next;break}b=b.next}},vj2.List=a}(),this.vj2=this.vj2||{},function(){"use strict";var a=function(){this.load("../resources/locations.json")};a.prototype=Object.create(vj2.Limb_config.prototype),vj2.Locations=a}(),window.onload=init;var WIDTH=1e3,HEIGHT=500,VIEW_ANGLE=45,ASPECT=WIDTH/HEIGHT,NEAR=.1,FAR=1e4,camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR),clock=new THREE.Clock,scene,renderer,action_upper_limbs,last_frame_time=0;this.vj2=this.vj2||{},function(){"use strict";var a=function(){this.load("../resources/orientations.json")};a.prototype=Object.create(vj2.Limb_config.prototype),vj2.Orientations=a}(),this.vj2=this.vj2||{},function(){"use strict";var a=function(){this.load("../resources/shapes.json")};a.prototype=Object.create(vj2.Limb_config.prototype),vj2.Shapes=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a,b,c){this.arm_bones=b,this.hand=a,this.direction=c}var b=a.prototype;b.update_wrist=function(a,b,c){this.arm_bones.update_wrist(a,b,c)},b.update_uparm=function(a,b,c){this.arm_bones.update_uparm(a,b,c)},b.update_loarm=function(a,b,c){this.arm_bones.update_loarm(a,b,c)},b.update_finger=function(a,b,c,d,e){this.hand.update_finger(a,b,c,d,e)},b.update=function(a){this.arm_bones.update(a),this.hand.update(a)},vj2.Upper_limbs=a}();