function Action_upper_limbs(a){this.human_model=a}function Hand(a,b,c,d,e,f){this.thumb=a,this.index=b,this.middle=c,this.ring=d,this.pinky=e,this.direction=f,this.animation_time=40,this.animation_time_now=this.animation_time}function Finger(a,b,c,d){this.phalange1=new Bone(a),this.phalange2=new Bone(b),this.phalange3=new Bone(c),this.direction=d}function load_model_json(a,b){function c(a){var c=new THREE.SkinnedMesh(a,new THREE.MeshLambertMaterial);c.material.skinning=!0,b(c)}var d=new THREE.JSONLoader;d.load(a,c)}function Upper_limbs(a,b,c){this.arm_bones=b,this.hand=a,this.direction=c}function Arm_bones(a,b,c,d){this.up_arm=new Bone(a),this.lo_arm=new Bone(b),this.wrist=new Bone(c),this.direction=d,this.json_arm_left_pose={ESPACO_NEUTRO:{up:{x:-1.333,y:-1.333,z:-1.333},lo:{x:0,y:-.1333,z:0},wrist:{x:0,y:0,z:1.33}},ORELHA:{up:{x:-1.33,y:0,z:0},lo:{x:0,y:-2,z:0},wrist:{x:0,y:0,z:0}}},this.json_arm_right_pose={ESPACO_NEUTRO:{up:{x:1.333,y:1.333,z:-1.333},lo:{x:0,y:.1333,z:0},wrist:{x:0,y:0,z:-1.33}},ORELHA:{up:{x:-1.33,y:0,z:0},lo:{x:0,y:2,z:0},wrist:{x:0,y:0,z:0}}},this.animation_time=40,this.animation_time_now=this.animation_time}function Bone(a){this.rotation=a,this.rotation_next=this.clone_rotation(a),this.rotation_prev=this.clone_rotation(a)}Action_upper_limbs.prototype.create_arm_bones=function(a,b,c,d){var e=this.human_model.bones[a].rotation,f=this.human_model.bones[b].rotation,g=this.human_model.bones[c].rotation;return new Arm_bones(e,f,g,d)},Action_upper_limbs.prototype.create_finger=function(a,b,c,d){var e=this.human_model.bones[a].rotation,f=this.human_model.bones[b].rotation,g=this.human_model.bones[c].rotation;return new Finger(e,f,g,d)},Action_upper_limbs.prototype.create_hand_left=function(){var a=this.create_finger(48,49,50,"LEFT"),b=this.create_finger(31,32,33,"LEFT"),c=this.create_finger(35,36,37,"LEFT"),d=this.create_finger(40,41,42,"LEFT"),e=this.create_finger(44,45,46,"LEFT");return new Hand(a,b,c,d,e,"LEFT")},Action_upper_limbs.prototype.create_hand_right=function(){var a=this.create_finger(74,75,76,"RIGHT"),b=this.create_finger(57,58,59,"RIGHT"),c=this.create_finger(61,62,63,"RIGHT"),d=this.create_finger(66,67,68,"RIGHT"),e=this.create_finger(70,71,72,"RIGHT");return new Hand(a,b,c,d,e,"RIGHT")},Action_upper_limbs.prototype.create_upper_limbs=function(){var a=this.create_arm_bones(26,27,28,"LEFT"),b=this.create_arm_bones(52,53,54,"RIGHT"),c=this.create_hand_left(),d=this.create_hand_right();this.upper_limbs_left=new Upper_limbs(c,a,"LEFT"),this.upper_limbs_right=new Upper_limbs(d,b,"RIGHT")},Action_upper_limbs.prototype.update_left=function(a,b,c,d){this.upper_limbs_left.update(a,b,c,d)},Action_upper_limbs.prototype.update_right=function(a,b,c,d){this.upper_limbs_right.update(a,b,c,d)},Action_upper_limbs.prototype.update_both=function(a,b,c,d){this.upper_limbs_right.update(a,b,c,d),this.upper_limbs_left.update(a,b,c,d)},Action_upper_limbs.prototype.set_shape=function(a){this.upper_limbs_right.set_shape(a),this.upper_limbs_left.set_shape(a)},Action_upper_limbs.prototype.animation=function(){this.upper_limbs_right.animation(),this.upper_limbs_left.animation()},Hand.prototype.open=function(){this.thumb.open(),this.index.open(),this.middle.open(),this.ring.open(),this.pinky.open()},Hand.prototype.close=function(){this.index.close(.1,0),this.middle.close(0,0),this.ring.close(-.1,0),this.pinky.close(-.2,0)},Hand.prototype.rock=function(){var a=-1.256;this.index.close(.1,a),this.middle.close(0,a),this.ring.close(-.1,a),this.pinky.close(-.2,a)},Hand.prototype.animation=function(){var a=this.animation_time_now/this.animation_time;this.thumb.animation(a),this.index.animation(a),this.middle.animation(a),this.ring.animation(a),this.pinky.animation(a),0===a?this.animation_time_now=this.animation_time:this.animation_time_now-=1},Hand.prototype.reset_animation=function(){this.animation_time_now=this.animation_time},Hand.prototype.set_shape=function(a){switch(a){case"MAO_FECHADA":this.close();break;case"MAO_ABERTA":this.open();break;case"PEDRA":this.rock()}this.reset_animation()},Finger.prototype.close=function(a,b){var c=b,d=a;"RIGHT"==this.direction&&(d*=-1,c*=-1),this.phalange1.set_rotation(0,d,c),this.phalange2.set_rotation(0,0,c),this.phalange3.set_rotation(0,0,c)},Finger.prototype.open=function(){this.phalange1.set_rotation(0,0,0),this.phalange2.set_rotation(0,0,0),this.phalange3.set_rotation(0,0,0)},Finger.prototype.animation=function(a){this.phalange1.animation(a),this.phalange2.animation(a),this.phalange3.animation(a)},Upper_limbs.prototype.set_shape=function(a){this.hand.set_shape(a)},Upper_limbs.prototype.update=function(a,b,c,d){this.arm_bones.update_pose(a,b,c,d)},Upper_limbs.prototype.animation=function(){this.arm_bones.animation(),this.hand.animation()},Arm_bones.prototype.animation=function(){var a=this.animation_time_now/this.animation_time;this.up_arm.animation(a),this.lo_arm.animation(a),this.wrist.animation(a),0===a?this.animation_time_now=this.animation_time:this.animation_time_now-=1},Arm_bones.prototype.animation_reset_time=function(){this.animation_time_now=this.animation_time},Arm_bones.prototype.update_pose=function(a,b,c,d){this.update_loc(d),this.update_wrist(a,b,c),this.animation_reset_time()},Arm_bones.prototype.update_wrist=function(a,b,c){"RIGHT"==this.direction?this.wrist.update_rotation(a,b,-c):"LEFT"==this.direction&&this.wrist.update_rotation(a,b,c)},Arm_bones.prototype.update_loc=function(a){var b;"RIGHT"==this.direction?b=this.json_arm_right_pose[a]:"LEFT"==this.direction&&(b=this.json_arm_left_pose[a]),this.update_arm(b.up,b.lo,b.wrist)},Arm_bones.prototype.update_arm=function(a,b,c){this.up_arm.set_rotation(a.x,a.y,a.z),this.lo_arm.set_rotation(b.x,b.y,b.z),this.wrist.set_rotation(c.x,c.y,c.z)},Bone.prototype.clone_rotation=function(a){var b=new THREE.Euler(0,0,0,"XYZ"),c=(new THREE.Quaternion).setFromEuler(a);return b.copy(a),b._quaternion=c,b._quaternion._euler=b,b},Bone.prototype.update_rotation=function(a,b,c){this.rotation_next.x+=a,this.rotation_next.y+=b,this.rotation_next.z+=c},Bone.prototype.set_rotation=function(a,b,c){this.rotation_next.x=a,this.rotation_next.y=b,this.rotation_next.z=c},Bone.prototype.animation=function(a){THREE.Quaternion.slerp(this.rotation_next._quaternion,this.rotation_prev._quaternion,this.rotation._quaternion,a),0===a&&this.end_animation()},Bone.prototype.end_animation=function(){this.rotation_prev=this.clone_rotation(this.rotation_next)};