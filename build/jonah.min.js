function init(){var a=$("#container");scene=new THREE.Scene,renderer=new THREE.WebGLRenderer,scene.add(camera);var b=new THREE.DirectionalLight(16777215);b.position.set(1,1,1).normalize(),scene.add(b),renderer.setSize(WIDTH,HEIGHT),renderer.setClearColor("white",1),a.append(renderer.domElement),camera.position.set(0,1,1),scene.position.set(0,.5,0),camera.lookAt(scene.position);var c=new THREE.JSONLoader;c.load("../resources/model/human.js",function(a){var b=new vj2.Model(a,new THREE.MeshLambertMaterial);b.material.skinning=!0,create_animation(b)})}function create_animation(a){scene.add(a),action_upper_limbs=new vj2.Action_upper_limbs(a,scene),last_frame_time=Date.now(),loop()}function rotate_camera(){var a=5e-4*Date.now();camera.position.y=1,camera.position.z=.5*Math.cos(a),camera.position.x=.5*Math.sin(a),camera.lookAt(scene.position)}function loop(){requestAnimationFrame(loop);var a=Date.now()-last_frame_time;action_upper_limbs.update(a/1e3),renderer.render(scene,camera),last_frame_time=Date.now()}this.vj2=this.vj2||{},function(){"use strict";function a(a,b){this.human_model=a,this.scene=b,this.bones_moving=new vj2.List;var c=this;(new vj2.Limb_config_loader).load("../resources/locations.json",function(a){c.locations=a}),(new vj2.Limb_config_loader).load("../resources/orientations.json",function(a){c.orientations=a}),(new vj2.Limb_config_loader).load("../resources/shapes.json",function(a){c.shapes=a})}var b=a.prototype;b.trace_quaternions=function(){this.trace_quaternions_side("LEFT"),this.trace_quaternions_side("RIGHT")},b.trace_quaternions_side=function(a){console.log(a+" ARM"),this.trace_quaternion("UpArm_"+a.charAt(0)),this.trace_quaternion("LoArm_"+a.charAt(0)),this.trace_quaternion("Hand_"+a.charAt(0)),console.log("==================================================");for(var b=1;5>=b;b++){switch(b){case 1:console.log(a+" THUMB");break;case 2:console.log(a+" INDEX");break;case 3:console.log(a+" MIDDLE");break;case 4:console.log(a+" RING");break;case 5:console.log(a+" PINKY")}for(var c=1;3>=c;c++)this.trace_quaternion("Finger-"+b+"-"+c+"_"+a.charAt(0));console.log("==================================================")}},b.trace_quaternion=function(a){var b=this.human_model.get_bone(a).getWorldQuaternion();console.log(a+" - GLOBAL: ("+b.x+", "+b.y+", "+b.z+", "+b.w+")");var c=this.human_model.get_bone(a).quaternion;console.log(a+" - LOCAL: ("+c.x+", "+c.y+", "+c.z+", "+c.w+")")},b.show_edit_controls=function(){this.eulerMode&&($(".debug-controls").hide(),$("#"+$("#select-edit-side").val()+"-"+$("#select-edit-part").val()).show())},b.reset_model_pose=function(){for(var a in this.animated_bone_pool){var b=this.animated_bone_pool[a];b.set(0,0,0,1)}},b.toggle_debug=function(){this.reset_model_pose(),this.eulerMode=!this.eulerMode,this.eulerMode?($("#select-edit-part").show(),$("#select-edit-side").show(),this.show_edit_controls()):($(".debug-controls").hide(),$("#select-edit-part").hide(),$("#select-edit-side").hide())},b.animated_bone_pool={},b.get_animated_bone=function(a){return void 0===this.animated_bone_pool[a]&&(this.animated_bone_pool[a]=new vj2.Animated_bone(this.human_model,a)),this.animated_bone_pool[a]},b.update=function(a){for(var b=this.bones_moving.head;null!==b;)b.obj.update(a),b.obj.done&&this.bones_moving.remove(b.obj),b=b.next},b.set_bone_euler=function(a,b,c,d){var e=this.get_animated_bone(a);e.euler_increment(b,c,d)},b.set_hand=function(a,b,c,d){a="undefined"==typeof a?"both":a;var e,f,g,h,i=this.locations.get_config(b,a),j=this.orientations.get_config(c,a),k=this.shapes.get_config(d,a),l={},m={};for(h in i)e=this.human_model.get_bone(h),f=i[h],l[h]=e.quaternion.clone(),e.quaternion.set(f.x,f.y,f.z,f.w);this.scene.updateMatrixWorld(!0),this.human_model.skeleton.update();for(h in j){var n=h,o=j[h];if(e=this.human_model.get_bone(n),f=(new THREE.Quaternion).multiplyQuaternions(e.parent.getWorldQuaternion().clone().inverse(),(new THREE.Quaternion).set(o.x,o.y,o.z,o.w)),void 0!==i[n]){var p=i[n];f=(new THREE.Quaternion).multiplyQuaternions(f,(new THREE.Quaternion).set(p.x,p.y,p.z,p.w))}m[n]=f}for(h in l)e=this.human_model.get_bone(h),f=l[h],e.quaternion.set(f.x,f.y,f.z,f.w);this.scene.updateMatrixWorld(!0),this.human_model.skeleton.update();for(h in m)g=this.get_animated_bone(h),f=m[h],g.done&&(this.bones_moving.add(g),g.animate_to(f.x,f.y,f.z,f.w,1.5));for(h in i)g=this.get_animated_bone(h),g.done&&(this.bones_moving.add(g),f=i[h],g.animate_to(f.x,f.y,f.z,f.w,1.5));for(h in k)g=this.get_animated_bone(h),g.done&&(this.bones_moving.add(g),f=k[h],g.animate_to(f.x,f.y,f.z,f.w,1.5))},vj2.Action_upper_limbs=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(a,b){this.bone_name=b,this.model=a,this.quaternion=this.model.get_bone(b).quaternion,this.quaternion_next=this.quaternion.clone(),this.quaternion_prev=this.quaternion.clone(),this.duration=0,this.remaining_time=0,this.done=!0,this.euler_helper=new THREE.Euler(0,0,0),this.quaternion_helper=new THREE.Quaternion(0,0,0)}var b=a.prototype;b.euler_increment=function(a,b,c,d){this.euler_helper.set(a,b,c),this.quaternion_helper.setFromEuler(this.euler_helper),this.increment(this.quaternion_helper.x,this.quaternion_helper.y,this.quaternion_helper.z,this.quaternion_helper.w,d)},b.euler_animate_to=function(a,b,c,d){this.euler_helper.set(a,b,c),this.quaternion_helper.setFromEuler(this.euler_helper),this.animate_to(this.quaternion_helper.x,this.quaternion_helper.y,this.quaternion_helper.z,this.quaternion_helper.w,d)},b.euler_set=function(a,b,c){this.euler_helper.set(a,b,c),this.quaternion_helper.setFromEuler(this.euler_helper),this.set(this.quaternion_helper.x,this.quaternion_helper.y,this.quaternion_helper.z,this.quaternion_helper.w)},b.increment=function(a,b,c,d,e){this.quaternion_next.multiply(new THREE.Quaternion(a,b,c,d)),this.animate_to(this.quaternion_next.x,this.quaternion_next.y,this.quaternion_next.z,this.quaternion_next.w,e)},b.animate_to=function(a,b,c,d,e){void 0===e||0===e?this.set(a,b,c,d):(this.quaternion_prev.copy(this.quaternion),this.quaternion_next.set(a,b,c,d),this.duration=e,this.remaining_time=this.duration,this.done=!1)},b.set=function(a,b,c,d){this.quaternion.set(a,b,c,d),this.quaternion_next.set(a,b,c,d),this.quaternion_prev.set(a,b,c,d),this.end_animation()},b.update=function(a){this.interpolate(this.remaining_time/this.duration),this.remaining_time-=Math.min(a,this.remaining_time)},b.interpolate=function(a){this.done||(THREE.Quaternion.slerp(this.quaternion_next,this.quaternion_prev,this.quaternion,a),0===a&&this.end_animation())},b.end_animation=function(){this.quaternion_prev.copy(this.quaternion_next),this.done=!0,this.remaining_time=0},b.reset_animation=function(){this.remaining_time=this.duration},vj2.Animated_bone=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}var b=a.prototype;b.get_config=function(a,b){var c={},d="";if("right"==b)for(d in this.right[a])c[d]=this.right[a][d];else if("left"==b)for(d in this.left[a])c[d]=this.left[a][d];else{for(d in this.right[a])c[d]=this.right[a][d];for(d in this.left[a])c[d]=this.left[a][d]}return c},vj2.Limb_config=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}var b=a.prototype;b.load=function(a,b){this.loadAjaxJSON(this,a,b)},b.loadAjaxJSON=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState===d.DONE)if(200===d.status||0===d.status)if(d.responseText){var e=JSON.parse(d.responseText),f=a.parse(e);c(f)}else console.error('load_limb_config: "'+b+'" seems to be unreachable or the file is empty.');else console.error("load_limb_config: Couldn't load \""+b+'" ('+d.status+")")},d.open("GET",b,!0),d.withCredentials=!1,d.send(null)},b.parse=function(a){var b=new vj2.Limb_config;b.right=a,b.left={};for(var c in b.right){var d=b.right[c],e={};for(var f in d){var g=f.split("_")[0],h={};h.x=d[f].x,h.y=-d[f].y,h.z=-d[f].z,h.w=d[f].w,e[g+"_L"]=h}b.left[c]=e}return b},vj2.Limb_config_loader=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){this.head=null,this.tail=null}var b=a.prototype;b.add=function(a){null===this.head?(this.head={obj:a,next:null},this.tail=this.head):(this.tail.next={obj:a,next:null},this.tail=this.tail.next)},b.remove=function(a){if(this.head.obj===a)this.head=this.head.next;else for(var b=this.head;null!==b.next;){if(b.next.obj===a){b.next=b.next.next;break}b=b.next}},vj2.List=a}(),this.vj2=this.vj2||{},function(){"use strict";var a=function(){vj2.Limb_config.call(this,"../resources/locations.json")};a.prototype=Object.create(vj2.Limb_config.prototype),a.prototype.constructor=a,vj2.Locations=a}(),window.onload=init;var WIDTH=1e3,HEIGHT=500,VIEW_ANGLE=45,ASPECT=WIDTH/HEIGHT,NEAR=.1,FAR=1e4,camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR),clock=new THREE.Clock,scene,renderer,action_upper_limbs,last_frame_time=0;this.vj2=this.vj2||{},function(){"use strict";function a(a,b,c){THREE.SkinnedMesh.call(this,a,b,c)}var b=a.prototype=Object.create(THREE.SkinnedMesh.prototype);a.prototype.constructor=a,b.get_bone=function(a){for(var b=this.skeleton.bones,c=0;c<b.length;c++)if(b[c].name==a)return b[c]},vj2.Model=a}(),this.vj2=this.vj2||{},function(){"use strict";var a=function(){vj2.Limb_config.call(this,"../resources/orientations.json")};a.prototype=Object.create(vj2.Limb_config.prototype),a.prototype.constructor=a,vj2.Orientations=a}(),this.vj2=this.vj2||{},function(){"use strict";var a=function(){vj2.Limb_config.call(this,"../resources/shapes.json")};a.prototype=Object.create(vj2.Limb_config.prototype),a.prototype.constructor=a,vj2.Shapes=a}(),this.vj2=this.vj2||{},function(){"use strict";function a(){}vj2.Transition=a}();